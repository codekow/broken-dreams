schemaVersion: 2.2.0
metadata:
  name: devspaces-gpu
attributes:
#   controller.devfile.io/scc: container-build
  controller.devfile.io/storage-type: ephemeral
# projects:
#   - name: devspaces-gpu
#     git:
#       remotes:
#         origin: "https://github.com/bkoz/devspaces.git"
#       checkoutFrom:
#         revision: main
components:
  - name: haz-gpu 
    kubernetes:
      inlined: |
        apiVersion: v1
        kind: Pod
        metadata:
          name: gpu-operator-test
        spec:
          restartPolicy: OnFailure
          containers:
            - name: cuda-vector-add
              # https://github.com/kubernetes/kubernetes/blob/v1.7.11/test/images/nvidia-cuda/Dockerfile
              image: "k8s.gcr.io/cuda-vector-add:v0.1"
              resources:
                limits:
                  nvidia.com/gpu: 1
  - attributes:
      container-overrides:
        resources:
          limits:
            nvidia.com/gpu: '1'
      controller.devfile.io/merge-contribution: true
    container:
      image: ghcr.io/redhat-na-ssa/udi-cuda:latest
      memoryLimit: 2G
      cpuLimit: 1000m
      mountSources: true
      sourceMapping: /projects
    name: python
commands:
  - id: haz-gpu
    apply:
      component: haz-gpu      
events:
  preStart:
    - haz-gpu